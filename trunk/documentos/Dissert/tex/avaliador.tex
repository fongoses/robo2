%==========================================================
% Capitulo x: Avaliador.
% 
% Autor
% Heitor Luis Polidoro
% 
% Orientador
% Prof. Dr. Denis Fernando Wolf
%==========================================================

\pagestyle{chapterst}

\chapter{Avaliador}
\label{avaliador}

O programa chamado \texttt{avaliador} é utilizado para avaliar os candidatos a seqüência de salas ótima do mapa analisado gerado pelo programa \texttt{gerador} \ref{gerador} e retorna para o \texttt{gerador} um valor numérico, baseado nesse valor o \texttt{gerador} irá guardar a seqüência como possível ótima, descartar ou continuar utilizando essa seqüência para gerar novas seqüência. Maiores detalhes na sessão \ref{gerador}.

\section{Funcionamento}

O \texttt{avaliador} recebe três parâmetros como entrada:
\begin{itemize}
	\item O nome do mapa onde o caminho será avaliado;
	\item Um vetor de vértices, representando a seqüência de salas a ser avaliada;
	\item Um valor opcional de limite para a avaliação.
\end{itemize}

Com esses parâmetros o \texttt{avaliador} inicia a simulação do robô navegando pelo mapa. A velocidade linear, que determina a velocidade com que o robô anda para frente ou para trás, é definida pela constante \texttt{SIMULACAO\_VEL} como 1 m/s. E a velocidade angular, que determina a velocidade com que o robô vira, é definida pela constante \texttt{SIMULACAO\_ROT} como 0.5 rad/s. Ambas constantes estão no arquivo \texttt{robo.h}. O tempo que o robô demora para visitar uma sala é definido pela constante \texttt{VISITAR\_SALA} como 5 s no arquivo \texttt{salas.h}.

Durante a simulação, a cada visita de sala o \texttt{avaliador} mede o Grau de Urgência Total e salva o maior valor, esse valor vai ser a avaliação do caminho neste mapa. Após a simulação o \texttt{avaliador} verifica se o caminho visita todos as salas, caso alguma sala não foi visitada o \texttt{avaliador} retorna a avaliação com valor negativo, se todas as salas foram visitadas o \texttt{avaliador} verifica se o caminho é um \textit{loop}, ou seja, se o caminho começa e termina no mesmo vértice, caso contrário ele também retorna a avaliação em valor negativo. Caso a avaliação do caminho for maior que o limite fornecido o valor 0 é retornado, se nenhum limite for fornecido o \texttt{avaliador} utiliza o valor do maior inteiro do compilador. Se o caminho for um \textit{loop} e visitar todas as salas, o valor da avaliação, maior Grau de Urgência Total em todo o percurso, é retornado pelo \texttt{avaliador}.

Para critério de parada o \texttt{avaliador} compara o estado das salas, ou seja, se para cada sala, o Grau de Urgência e o número de visitas é o mesmo ao término do caminho.

\section{Algoritmo}

\begin{algorithm}
\caption{\texttt{avaliador}}
\label{alg:avaliador}
\begin{algorithmic}[1]
\REQUIRE mapa, caminho, limite = \texttt{INT\_MAX} 
\ENSURE A avaliação do $caminho$ no $mapa$
	\STATE carregar ($mapa$)
	\STATE $aval \leftarrow 0$
	\REPEAT
		\STATE $salas\_anterior \leftarrow salas\_atual$
		\FORALL {vértice $v$ em $caminho$}
			\STATE Calcula o tempo necessário para o robô chegar ao vértice $v$
			\STATE Soma à esse tempo o tempo para visitar a sala do vértice $v$
			\STATE Atualiza os Graus de Urgência das salas Com o tempo calculado
			\IF {Grau de Urgência atual > $maior$}
				\STATE $maior \leftarrow$ Grau de Urgência atual
			\ENDIF
			\IF {Caminho não visita todas as salas do mapa}
				\RETURN $-aval$
			\ENDIF
			\STATE Visita a sala do vértice $v$
		\ENDFOR
	\UNTIL $salas\_anterior$ = $salas\_atual$
\end{algorithmic}
\end{algorithm}

